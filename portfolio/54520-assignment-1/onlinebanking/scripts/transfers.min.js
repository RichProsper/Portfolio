import Header from"../../scripts/header.min.js";import{formatCurrency,TRStringToNodes,formatDate,logout}from"./utilities.min.js";null===localStorage.getItem("currentUser")?location.href="login.html":document.querySelector("body").classList.remove("hidden"),Header(),logout();const user=JSON.parse(localStorage.getItem("currentUser")),users=JSON.parse(localStorage.getItem("users")),userIndex=users.map((e=>e.userId)).indexOf(user.userId),tbody=document.getElementById("transfers"),transfers=user.transactions.transfers;transfers.sort(((e,t)=>t.createdOn-e.createdOn)),document.getElementById("name").textContent=user.name,document.getElementById("balance").textContent=formatCurrency(user.balance),document.getElementById("amount").max=user.balance,transfers.forEach((e=>{tbody.append(...TRStringToNodes(`\n        <tr>\n            <td>${e.payee}</td>\n            <td>${formatDate(e.createdOn)}</td>\n            <td>${formatCurrency(e.amount)}</td>\n        </tr>\n    `))})),document.querySelector("form").addEventListener("submit",(function(e){e.preventDefault(),document.querySelector("rwc-alert").openAlert(),user.balance-=+this.amount.value,user.transactions.transfers.push({payee:this.name.value.trim(),amount:+this.amount.value,createdOn:(new Date).getTime(),type:"Transfer"}),users[userIndex]=user,localStorage.setItem("currentUser",JSON.stringify(user)),localStorage.setItem("users",JSON.stringify(users)),setTimeout((()=>location.reload()),5201)}));